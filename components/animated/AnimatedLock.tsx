import React, { useEffect, useState } from 'react';
import { View } from 'react-native';
import Svg, { G, Rect, Path, ClipPath, Defs, Mask } from 'react-native-svg';
import Animated, { useSharedValue, useAnimatedStyle, withTiming, Easing, withRepeat } from 'react-native-reanimated';

// Create an animated component from Path
const AnimatedRect = Animated.createAnimatedComponent(Rect);
const AnimatedG = Animated.createAnimatedComponent(G);

const AnimatedLock = () => {
    const rotate = useSharedValue(-4); // Subtle upwards tilt
    const translateY = useSharedValue(-2); // Small lift upwards to keep it near the bottom part
    const scale = useSharedValue(1); // Scale for pulse effect

  // Trigger the lock closing animation and pulse effect
  useEffect(() => {
    // Animate the padlock head closing after 3 seconds
    const closeLockTimer = setTimeout(() => {
      rotate.value = withTiming(0, {
        duration: 800,
        easing: Easing.inOut(Easing.ease),
      });
      translateY.value = withTiming(0, {
        duration: 800,
        easing: Easing.inOut(Easing.ease),
      });

      // Start the pulse animation every 2 seconds after the lock closes
      const pulseInterval = setInterval(() => {
        // Pulse in (scale up)
        scale.value = withTiming(1.1, {
          duration: 500,
          easing: Easing.inOut(Easing.ease),
        });

        // Pulse out (scale down) after a short delay
        setTimeout(() => {
          scale.value = withTiming(1, {
            duration: 500,
            easing: Easing.inOut(Easing.ease),
          });
        }, 500); // Match the duration of the pulse in
      }, 5000); // Repeat every 2 seconds

      return () => clearInterval(pulseInterval);
    }, 3000); // Delay before the animation starts

    return () => clearTimeout(closeLockTimer);
  }, []);

  // Animated style for rotating and translating the padlock head
  const animatedHeadStyle = useAnimatedStyle(() => {
    return {
      transform: [
        { rotate: `${rotate.value}deg` },
        { translateY: translateY.value },
      ],
    };
  });

  // Animated style for pulsing the padlock body
  const animatedBodyStyle = useAnimatedStyle(() => {
    return {
      transform: [{ scale: scale.value }],
    };
  });



  return (
    <Svg width="245" height="245" viewBox="0 0 245 245" fill="none" xmlns="http://www.w3.org/2000/svg">
    <G clip-path="url(#clip0_4576_9403)">
    <Rect width="245" height="245" rx="122.5" fill="#FF8A49"/>
    <Path fill-rule="evenodd" clip-rule="evenodd" d="M107.001 72.5663C125.106 72.5663 139.784 57.8888 139.784 39.7832C139.784 21.6775 125.106 7 107.001 7C94.4981 7 83.6302 13.9988 78.101 24.2922H73.137C59.8065 24.2922 49 35.0987 49 48.4293C49 61.7598 59.8065 72.5663 73.137 72.5663H98.3549C99.7138 72.5663 101.047 72.454 102.344 72.2382C103.865 72.4544 105.42 72.5663 107.001 72.5663Z" fill="#FFA776"/>

    <Mask id="path-3-inside-1_4576_9403" fill="white">
    <Path fill-rule="evenodd" clip-rule="evenodd" d="M144.218 30.6581H140.384C122.146 30.6581 107.361 45.4428 107.361 63.6807C107.361 81.9186 122.146 96.7034 140.384 96.7034H174.885C176.272 96.7034 177.638 96.6179 178.98 96.452C180.549 96.6182 182.143 96.7034 183.756 96.7034C185.919 96.7034 188.046 96.5503 190.128 96.2543C191.903 96.5497 193.727 96.7034 195.586 96.7034H230.088C248.326 96.7034 263.11 81.9186 263.11 63.6807C263.11 45.4428 248.326 30.6581 230.088 30.6581H223.295C215.73 16.5753 200.862 7 183.756 7C166.651 7 151.783 16.5753 144.218 30.6581Z"/>
    </Mask>

    <Path fill-rule="evenodd" clip-rule="evenodd" d="M144.218 30.6581H140.384C122.146 30.6581 107.361 45.4428 107.361 63.6807C107.361 81.9186 122.146 96.7034 140.384 96.7034H174.885C176.272 96.7034 177.638 96.6179 178.98 96.452C180.549 96.6182 182.143 96.7034 183.756 96.7034C185.919 96.7034 188.046 96.5503 190.128 96.2543C191.903 96.5497 193.727 96.7034 195.586 96.7034H230.088C248.326 96.7034 263.11 81.9186 263.11 63.6807C263.11 45.4428 248.326 30.6581 230.088 30.6581H223.295C215.73 16.5753 200.862 7 183.756 7C166.651 7 151.783 16.5753 144.218 30.6581Z" fill="#FFA776"/>

    <Path d="M144.218 30.6581V34.9811H146.803L148.026 32.7037L144.218 30.6581ZM178.98 96.452L179.435 92.153L178.942 92.1008L178.449 92.1616L178.98 96.452ZM190.128 96.2543L190.837 91.9899L190.179 91.8804L189.519 91.9743L190.128 96.2543ZM223.295 30.6581L219.487 32.7037L220.71 34.9811H223.295V30.6581ZM144.218 26.335H140.384V34.9811H144.218V26.335ZM140.384 26.335C119.759 26.335 103.038 43.0553 103.038 63.6807H111.684C111.684 47.8304 124.534 34.9811 140.384 34.9811V26.335ZM103.038 63.6807C103.038 84.3062 119.759 101.026 140.384 101.026V92.3803C124.534 92.3803 111.684 79.5311 111.684 63.6807H103.038ZM140.384 101.026H174.885V92.3803H140.384V101.026ZM174.885 101.026C176.45 101.026 177.993 100.93 179.511 100.742L178.449 92.1616C177.283 92.3058 176.094 92.3803 174.885 92.3803V101.026ZM178.525 100.751C180.245 100.933 181.991 101.026 183.756 101.026V92.3803C182.295 92.3803 180.854 92.3031 179.435 92.153L178.525 100.751ZM183.756 101.026C186.124 101.026 188.454 100.859 190.736 100.534L189.519 91.9743C187.639 92.2417 185.715 92.3803 183.756 92.3803V101.026ZM189.418 100.519C191.427 100.853 193.488 101.026 195.586 101.026V92.3803C193.965 92.3803 192.379 92.2464 190.837 91.9899L189.418 100.519ZM195.586 101.026H230.088V92.3803H195.586V101.026ZM230.088 101.026C250.713 101.026 267.433 84.3062 267.433 63.6807H258.787C258.787 79.5311 245.938 92.3803 230.088 92.3803V101.026ZM267.433 63.6807C267.433 43.0553 250.713 26.335 230.088 26.335V34.9811C245.938 34.9811 258.787 47.8304 258.787 63.6807H267.433ZM230.088 26.335H223.295V34.9811H230.088V26.335ZM227.103 28.6124C218.816 13.1832 202.516 2.67695 183.756 2.67695V11.3231C199.207 11.3231 212.645 19.9673 219.487 32.7037L227.103 28.6124ZM183.756 2.67695C164.997 2.67695 148.697 13.1832 140.41 28.6124L148.026 32.7037C154.868 19.9673 168.306 11.3231 183.756 11.3231V2.67695Z" fill="#FF8A49" mask="url(#path-3-inside-1_4576_9403)"/>

 {/** padlock bottom */}
 <AnimatedG style={animatedBodyStyle}>
 <Path d="M153.387 110.483H91.9049C86.6258 110.483 81.5629 112.58 77.83 116.313C74.0971 120.046 72 125.109 72 130.388V172.213C72 177.492 74.0971 182.555 77.83 186.288C81.5629 190.02 86.6258 192.118 91.9049 192.118H153.387C158.666 192.118 163.729 190.02 167.462 186.288C171.194 182.555 173.292 177.492 173.292 172.213V130.388C173.292 125.109 171.194 120.046 167.462 116.313C163.729 112.58 158.666 110.483 153.387 110.483ZM130.556 162.459C130.664 163.113 130.629 163.783 130.453 164.422C130.276 165.061 129.963 165.654 129.535 166.159C129.107 166.665 128.573 167.072 127.972 167.351C127.371 167.63 126.716 167.775 126.054 167.776H119.251C118.589 167.775 117.934 167.63 117.333 167.351C116.732 167.072 116.199 166.665 115.77 166.159C115.342 165.654 115.029 165.061 114.853 164.422C114.676 163.783 114.641 163.113 114.75 162.459L117.034 148.643C115.889 147.525 115.103 146.09 114.777 144.523C114.45 142.955 114.599 141.326 115.203 139.843C115.807 138.361 116.839 137.092 118.167 136.198C119.496 135.305 121.061 134.828 122.662 134.828C124.263 134.828 125.827 135.305 127.156 136.198C128.484 137.092 129.516 138.361 130.12 139.843C130.724 141.326 130.873 142.955 130.546 144.523C130.22 146.09 129.434 147.525 128.289 148.643L130.556 162.459Z" fill="#FFC5A4"/>
 </AnimatedG>

    <Path d="M153.387 110.483H91.9049C86.6258 110.483 81.5629 112.58 77.83 116.313C74.0971 120.046 72 125.109 72 130.388V172.213C72 177.492 74.0971 182.555 77.83 186.288C81.5629 190.02 86.6258 192.118 91.9049 192.118H153.387C158.666 192.118 163.729 190.02 167.462 186.288C171.194 182.555 173.292 177.492 173.292 172.213V130.388C173.292 125.109 171.194 120.046 167.462 116.313C163.729 112.58 158.666 110.483 153.387 110.483ZM130.556 162.459C130.664 163.113 130.629 163.783 130.453 164.422C130.276 165.061 129.963 165.654 129.535 166.159C129.107 166.665 128.573 167.072 127.972 167.351C127.371 167.63 126.716 167.775 126.054 167.776H119.251C118.589 167.775 117.934 167.63 117.333 167.351C116.732 167.072 116.199 166.665 115.77 166.159C115.342 165.654 115.029 165.061 114.853 164.422C114.676 163.783 114.641 163.113 114.75 162.459L117.034 148.643C115.889 147.525 115.103 146.09 114.777 144.523C114.45 142.955 114.599 141.326 115.203 139.843C115.807 138.361 116.839 137.092 118.167 136.198C119.496 135.305 121.061 134.828 122.662 134.828C124.263 134.828 125.827 135.305 127.156 136.198C128.484 137.092 129.516 138.361 130.12 139.843C130.724 141.326 130.873 142.955 130.546 144.523C130.22 146.09 129.434 147.525 128.289 148.643L130.556 162.459Z" fill="#FFC5A4"/>

    {/** paddlock head */}
    <AnimatedG style={animatedHeadStyle}>
          <Path
            d="
              M100 114
              C100 120, 110 120, 110 114
              L110 104
              C110 90, 130 90, 130 104
              L130 114
              C130 120, 140 120, 140 114
              L140 104
              C140 70, 100 70, 100 104
              Z"
            fill="#FFC5A4"
          />
        </AnimatedG>



    </G>
    <Defs>
    <ClipPath id="clip0_4576_9403">
    <Rect width="245" height="245" rx="122.5" fill="white"/>
    </ClipPath>
    </Defs>
    </Svg>

  );
};

export default AnimatedLock;
